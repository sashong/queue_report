<div class="container">

  <h1>Queue Status Dashboard</h1>

  <!-- KPI DASHBOARD -->
  <div class="kpi-grid">
    <div class="kpi">
      <div class="kpi-value">{{ dashboard.total }}</div>
      <div class="kpi-label">Total Records</div>
    </div>
    <div class="kpi success">
      <div class="kpi-value">{{ dashboard.completed }}</div>
      <div class="kpi-label">Completed</div>
    </div>
    <div class="kpi info">
      <div class="kpi-value">{{ dashboard.ongoing }}</div>
      <div class="kpi-label">Ongoing</div>
    </div>
    <div class="kpi danger">
      <div class="kpi-value">{{ dashboard.failed }}</div>
      <div class="kpi-label">Validation Failed</div>
    </div>
  </div>

  <!-- QUEUE SELECT -->
  <div class="card action-row">

  <!-- LEFT SIDE -->
  <div class="left-actions">
    <select [(ngModel)]="selectedQueueId">
      <option value="">Select Queue</option>
      <option *ngFor="let q of queues" [value]="q.id">
        {{ q.queuename }}
      </option>
    </select>

    <button
      class="btn-primary"
      (click)="loadReport()"
      [disabled]="loading || !selectedQueueId">
      <span *ngIf="!loading">Load Report</span>
      <span *ngIf="loading" class="btn-spinner"></span>
    </button>
  </div>

  <!-- RIGHT SIDE -->
  <div class="right-actions">
    <input
      type="text"
      placeholder="Search..."
      [(ngModel)]="searchText"
      (input)="applyFilters()" />

    <button class="btn-outline" (click)="exportCSV()">
      Export CSV
    </button>
  </div>

</div>

  <!-- TABLE -->
  <table *ngIf="paginatedRecords.length > 0">
    <thead>
      <tr>
        <th>Participant</th>
        <th>Product</th>
        

        <th class="filter-header">
          Product Status
          <span (click)="toggleFilter('status')">▼</span>
          <select *ngIf="activeFilter==='status'"
                  [(ngModel)]="selectedProductStatus"
                  (change)="applyFilters(); closeFilter()">
            <option value="">All</option>
            <option *ngFor="let o of productStatusOptions" [value]="o.value">
              {{ o.value }} ({{ o.count }})
            </option>
          </select>
        </th>

        <th class="filter-header">
          Mode
          <span (click)="toggleFilter('mode')">▼</span>
          <select *ngIf="activeFilter==='mode'"
                  [(ngModel)]="selectedIntegrationMode"
                  (change)="applyFilters(); closeFilter()">
            <option value="">All</option>
            <option *ngFor="let o of integrationModeOptions" [value]="o.value">
              {{ o.value }} ({{ o.count }})
            </option>
          </select>
        </th>

        <th class="filter-header">
          Stage
          <span (click)="toggleFilter('stage')">▼</span>
          <select *ngIf="activeFilter==='stage'"
                  [(ngModel)]="selectedStage"
                  (change)="applyFilters(); closeFilter()">
            <option value="">All</option>
            <option *ngFor="let o of stageOptions" [value]="o.value">
              {{ o.value }} ({{ o.count }})
            </option>
          </select>
        </th>

        <th>Validation</th>
        <th>Reason</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let r of paginatedRecords">
        <td>{{ r.participantName }}</td>
        <td>{{ r.productName }}</td>
        
        <td>{{ r.productStatus }}</td>
        <td>{{ r.integrationMode }}</td>
        <td>{{ r.tokenStage }}</td>
        <td>
          <span class="ok" *ngIf="r.validationPassed">✔ Valid</span>
          <span class="fail" *ngIf="!r.validationPassed">✖ Invalid</span>
        </td>
        <td>{{r.validationReason}}</td>
      </tr>
    </tbody>
  </table>

  <!-- PAGINATION -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button (click)="prevPage()">Prev</button>
    Page {{ currentPage }} / {{ totalPages }}
    <button (click)="nextPage()">Next</button>
  </div>

</div>
